{"version":3,"sources":["SPARQL/QueryDocument/QueryDocumentsBuilder.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,0CAOyB;AAEzB,0EAAyE;AACzE,oEAAmE;AACnE,+DAA8D;AAE9D,iCAAwC;AAOxC;IAA2C,yCAAoB;IAA/D;;IA0EA,CAAC;IAtEA,uCAAO,GAAP,UAAS,QAAe,EAAE,IAAiD;QAC1E,IAAI,WAAW,GAAiB,IAAI,CAAC,QAAQ,CAAE,QAAQ,CAAE,CAAC;QAE1D,IAAM,MAAM,GAAe,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC,IAAI,CAAE,UAAA,OAAO,IAAI,OAAA,OAAO,CAAC,KAAK,KAAK,QAAQ,EAA1B,CAA0B,CAAiB,CAAC;QACrH,IAAI,CAAE,MAAM;YAAG,MAAM,IAAI,qCAAiB,CAAE,0CAA0C,CAAE,CAAC;QAEzF,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC,CAAC;QACzB,IAAM,UAAU,GAAU,MAAM,CAAC,SAAS,CAAC,SAAS,CAAE,UAAA,OAAO,IAAI,OAAA,OAAO,CAAC,KAAK,KAAK,OAAO,EAAzB,CAAyB,CAAE,CAAC;QAE7F,IAAI,UAAU,KAAK,CAAE,CAAC,EAAG;YACxB,MAAM,CAAC,SAAS,CAAC,MAAM,CAAE,UAAU,EAAE,CAAC,CAAE,CAAC;YAEzC,IAAM,aAAa,GAAU,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAE,UAAA,OAAO,IAAI,OAAA,OAAO,CAAC,KAAK,KAAK,UAAU,EAA5B,CAA4B,CAAE,CAAC;YAClG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAE,aAAa,EAAE,CAAC,CAAE,CAAC;SAC3C;QAED,IAAM,aAAa,GAAkB,eAAe,CAAE,IAAI,CAAE,CAAC;QAC7D,MAAM,CAAC,SAAS,CAAC,OAAO,CAAE,IAAI,mBAAU,CAAE,WAAW,CAAC,QAAQ,EAAE,aAAa,CAAE,CAAE,CAAC;QAElF,IAAM,SAAS,GAAkC;YAChD,IAAI,EAAE,WAAW,CAAC,IAAI;iBACpB,KAAK,CAAE,GAAG,CAAE;iBACZ,KAAK,CAAE,CAAC,CAAE;iBACV,IAAI,CAAE,GAAG,CAAE;YACb,IAAI,EAAE,aAAa;SACnB,CAAC;QAEF,IAAI,oBAAkC,CAAC;QACvC,OAAO,WAAW,KAAK,IAAI,CAAC,SAAS,EAAG;YACvC,IAAM,cAAc,GAAgB,WAAW,IAAI,WAAW,CAAC,SAAS,EAAE,CAAC;YAC3E,IAAI,CAAE,cAAc;gBAAG,MAAM,IAAI,2CAAoB,CAAE,oBAAkB,WAAW,CAAC,IAAI,uDAAoD,CAAE,CAAC;YAEhJ,IAAM,eAAe,GAAiB,IAAI,sBAAa,EAAE;iBACvD,UAAU,CAAE,cAAc,CAAE,CAAC;YAE/B,IAAI,oBAAoB;gBAAG,eAAe,CAAC,UAAU,CAAE,oBAAoB,CAAE,CAAC;YAC9E,oBAAoB,GAAG,eAAe,CAAC;YAEvC,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAE,qBAAa,CAAE,WAAW,CAAC,IAAI,CAAE,CAAE,CAAC;SAC7E;QAED,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;QAC5B,MAAM,CAAC,UAAU,CAAE,oBAAoB,CAAE,CAAC;QAE1C,OAAO,IAAI,CAAC;IACb,CAAC;IAED,qCAAK,GAAL,UAAO,KAAY;QAClB,IAAM,MAAM,GAAe,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC,IAAI,CAAE,UAAA,OAAO,IAAI,OAAA,OAAO,CAAC,KAAK,KAAK,QAAQ,EAA1B,CAA0B,CAAiB,CAAC;QACrH,IAAI,CAAE,MAAM;YAAG,MAAM,IAAI,qCAAiB,CAAE,0CAA0C,CAAE,CAAC;QAEzF,IAAM,UAAU,GAAU,MAAM,CAAC,SAAS,CAAC,SAAS,CAAE,UAAA,OAAO,IAAI,OAAA,OAAO,CAAC,KAAK,KAAK,OAAO,EAAzB,CAAyB,CAAE,CAAC;QAC7F,IAAI,UAAU,KAAK,CAAE,CAAC;YAAG,MAAM,CAAC,SAAS,CAAC,MAAM,CAAE,UAAU,EAAE,CAAC,CAAE,CAAC;QAElE,MAAM,CAAC,SAAS,CAAC,IAAI,CAAE,IAAI,mBAAU,CAAE,KAAK,CAAE,CAAE,CAAC;QAEjD,OAAO,IAAI,CAAC;IACb,CAAC;IAED,sCAAM,GAAN,UAAQ,MAAa;QACpB,IAAM,MAAM,GAAe,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC,IAAI,CAAE,UAAA,OAAO,IAAI,OAAA,OAAO,CAAC,KAAK,KAAK,QAAQ,EAA1B,CAA0B,CAAiB,CAAC;QACrH,IAAI,CAAE,MAAM;YAAG,MAAM,IAAI,qCAAiB,CAAE,0CAA0C,CAAE,CAAC;QAEzF,IAAM,WAAW,GAAU,MAAM,CAAC,SAAS,CAAC,SAAS,CAAE,UAAA,OAAO,IAAI,OAAA,OAAO,CAAC,KAAK,KAAK,QAAQ,EAA1B,CAA0B,CAAE,CAAC;QAC/F,IAAI,WAAW,KAAK,CAAE,CAAC;YAAG,MAAM,CAAC,SAAS,CAAC,MAAM,CAAE,WAAW,EAAE,CAAC,CAAE,CAAC;QAEpE,MAAM,CAAC,SAAS,CAAC,IAAI,CAAE,IAAI,oBAAW,CAAE,MAAM,CAAE,CAAE,CAAC;QACnD,OAAO,IAAI,CAAC;IACb,CAAC;IAEF,4BAAC;AAAD,CA1EA,AA0EC,CA1E0C,2CAAoB,GA0E9D;AA1EY,sDAAqB;AA4ElC,yBAA0B,IAAiD;IAC1E,IAAI,IAAI,KAAK,KAAK,CAAC;QAAG,OAAO,KAAK,CAAC,CAAC;IAEpC,IAAM,SAAS,GAA+C,IAAI;SAChE,WAAW,EAAS,CAAC;IAEvB,QAAQ,SAAS,EAAG;QACnB,KAAK,KAAK,CAAC;QACX,KAAK,MAAM;YACV,OAAO,SAAS,CAAC;QAElB,KAAK,WAAW,CAAC;QACjB,KAAK,YAAY;YAChB,OAAO,SAAS;iBACd,KAAK,CAAE,CAAC,EAAE,CAAE,CAAC,CAAoB,CAAC;QAErC;YACC,MAAM,IAAI,2CAAoB,CAAE,qBAAqB,CAAE,CAAC;KACzD;AACF,CAAC","file":"QueryDocumentsBuilder.js","sourcesContent":["import {\n\tLimitToken,\n\tOffsetToken,\n\tOptionalToken,\n\tOrderToken,\n\tSelectToken,\n\tSubjectToken,\n} from \"sparqler/tokens\";\n\nimport { IllegalArgumentError } from \"../../Errors/IllegalArgumentError\";\nimport { IllegalStateError } from \"../../Errors/IllegalStateError\";\nimport { QueryDocumentBuilder } from \"./QueryDocumentBuilder\";\nimport { QueryProperty } from \"./QueryProperty\";\nimport { getParentPath } from \"./Utils\";\n\nexport interface QueryDocumentsBuilderOrderData {\n\tpath:string;\n\tflow?:\"ASC\" | \"DESC\";\n}\n\nexport class QueryDocumentsBuilder extends QueryDocumentBuilder {\n\n\t_orderData?:QueryDocumentsBuilderOrderData;\n\n\torderBy( property:string, flow?:\"ASC\" | \"DESC\" | \"ascending\" | \"descending\" ):this {\n\t\tlet propertyObj:QueryProperty = this.property( property );\n\n\t\tconst select:SelectToken = this._document.getPatterns().find( pattern => pattern.token === \"select\" ) as SelectToken;\n\t\tif( ! select ) throw new IllegalStateError( `A sub-select token has not been defined.` );\n\n\t\tthis._orderData = void 0;\n\t\tconst orderIndex:number = select.modifiers.findIndex( pattern => pattern.token === \"order\" );\n\n\t\tif( orderIndex !== - 1 ) {\n\t\t\tselect.modifiers.splice( orderIndex, 1 );\n\n\t\t\tconst optionalIndex:number = select.patterns.findIndex( pattern => pattern.token === \"optional\" );\n\t\t\tselect.patterns.splice( optionalIndex, 1 );\n\t\t}\n\n\t\tconst validatedFlow:\"ASC\" | \"DESC\" = parseFlowString( flow );\n\t\tselect.modifiers.unshift( new OrderToken( propertyObj.variable, validatedFlow ) );\n\n\t\tconst orderData:QueryDocumentsBuilderOrderData = {\n\t\t\tpath: propertyObj.name\n\t\t\t\t.split( \".\" )\n\t\t\t\t.slice( 1 )\n\t\t\t\t.join( \".\" ),\n\t\t\tflow: validatedFlow,\n\t\t};\n\n\t\tlet propertyPatternsPath:OptionalToken;\n\t\twhile( propertyObj !== this._document ) {\n\t\t\tconst propertyTriple:SubjectToken = propertyObj && propertyObj.getTriple();\n\t\t\tif( ! propertyTriple ) throw new IllegalArgumentError( `The property \"${ propertyObj.name }\" is not a valid property defined by the builder.` );\n\n\t\t\tconst propertyPattern:OptionalToken = new OptionalToken()\n\t\t\t\t.addPattern( propertyTriple );\n\n\t\t\tif( propertyPatternsPath ) propertyPattern.addPattern( propertyPatternsPath );\n\t\t\tpropertyPatternsPath = propertyPattern;\n\n\t\t\tpropertyObj = this._context.getProperty( getParentPath( propertyObj.name ) );\n\t\t}\n\n\t\tthis._orderData = orderData;\n\t\tselect.addPattern( propertyPatternsPath );\n\n\t\treturn this;\n\t}\n\n\tlimit( limit:number ):this {\n\t\tconst select:SelectToken = this._document.getPatterns().find( pattern => pattern.token === \"select\" ) as SelectToken;\n\t\tif( ! select ) throw new IllegalStateError( `A sub-select token has not been defined.` );\n\n\t\tconst limitIndex:number = select.modifiers.findIndex( pattern => pattern.token === \"limit\" );\n\t\tif( limitIndex !== - 1 ) select.modifiers.splice( limitIndex, 1 );\n\n\t\tselect.modifiers.push( new LimitToken( limit ) );\n\n\t\treturn this;\n\t}\n\n\toffset( offset:number ):this {\n\t\tconst select:SelectToken = this._document.getPatterns().find( pattern => pattern.token === \"select\" ) as SelectToken;\n\t\tif( ! select ) throw new IllegalStateError( `A sub-select token has not been defined.` );\n\n\t\tconst offsetIndex:number = select.modifiers.findIndex( pattern => pattern.token === \"offset\" );\n\t\tif( offsetIndex !== - 1 ) select.modifiers.splice( offsetIndex, 1 );\n\n\t\tselect.modifiers.push( new OffsetToken( offset ) );\n\t\treturn this;\n\t}\n\n}\n\nfunction parseFlowString( flow?:\"ASC\" | \"DESC\" | \"ascending\" | \"descending\" ):\"ASC\" | \"DESC\" {\n\tif( flow === void 0 ) return void 0;\n\n\tconst upperCase:\"ASC\" | \"DESC\" | \"ASCENDING\" | \"DESCENDING\" = flow\n\t\t.toUpperCase() as any;\n\n\tswitch( upperCase ) {\n\t\tcase \"ASC\":\n\t\tcase \"DESC\":\n\t\t\treturn upperCase;\n\n\t\tcase \"ASCENDING\":\n\t\tcase \"DESCENDING\":\n\t\t\treturn upperCase\n\t\t\t\t.slice( 0, - 6 ) as \"ASC\" | \"DESC\";\n\n\t\tdefault:\n\t\t\tthrow new IllegalArgumentError( \"Invalid flow order.\" );\n\t}\n}\n\n"]}