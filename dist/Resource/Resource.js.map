{"version":3,"sources":["Resource/Resource.ts"],"names":[],"mappings":"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","file":"Resource.js","sourcesContent":["import { PartialMetadata } from \"../SPARQL/QueryDocument\";\nimport * as Utils from \"../Utils\";\nimport {\n\tTransientResource,\n\tTransientResourceFactory,\n} from \"./TransientResource\";\n\n\nexport interface Resource extends TransientResource {\n\t_snapshot:TransientResource;\n\n\t_partialMetadata?:PartialMetadata;\n\n\n\t_syncSnapshot():void;\n\n\n\tisDirty():boolean;\n\n\trevert():void;\n\n\n\tisPartial():boolean;\n}\n\n\nexport interface ResourceFactory extends TransientResourceFactory {\n\tisDecorated( object:object ):object is Resource;\n\n\tdecorate<T extends object>( object:T ):T & Resource;\n\n\n\tis( value:any ):value is Resource;\n}\n\n\nfunction syncSnapshot( this:Resource ):void {\n\tthis._snapshot = Utils.ObjectUtils.clone( this, { arrays: true } );\n\n\tthis._snapshot.id = this.id;\n\tthis._snapshot.types = this.types.slice();\n}\n\nfunction isDirty( this:Resource ):boolean {\n\tif( ! Utils.ObjectUtils.areEqual( this, this._snapshot, { arrays: true } ) ) return true;\n\n\tlet response:boolean = false;\n\tif( \"id\" in this ) response = response || (this._snapshot as TransientResource).id !== this.id;\n\tif( \"types\" in this ) response = response || ! Utils.ObjectUtils.areEqual( (this._snapshot as TransientResource).types, this.types );\n\n\treturn response;\n}\n\nfunction revert( this:Resource ):void {\n\tfor( let key of Object.keys( this ) ) {\n\t\tif( ! (key in this._snapshot) ) delete this[ key ];\n\t}\n\n\tUtils.ObjectUtils.extend( this, this._snapshot, { arrays: true } );\n}\n\nfunction isPartial( this:Resource ):boolean {\n\treturn ! ! this._partialMetadata;\n}\n\nexport const Resource:ResourceFactory = {\n\tisDecorated( object:object ):object is Resource {\n\t\treturn (\n\t\t\tUtils.hasPropertyDefined( object, \"_snapshot\" )\n\t\t\t&& Utils.hasFunction( object, \"_syncSnapshot\" )\n\t\t\t&& Utils.hasFunction( object, \"isDirty\" )\n\t\t\t&& Utils.hasFunction( object, \"isPartial\" )\n\t\t\t&& Utils.hasFunction( object, \"revert\" )\n\t\t);\n\t},\n\n\tdecorate<T extends object>( object:T ):T & Resource {\n\t\tif( Resource.isDecorated( object ) ) return object;\n\n\t\tTransientResource.decorate( object );\n\n\t\tconst persistedResource:T & Resource = object as T & Resource;\n\t\tObject.defineProperties( persistedResource, {\n\t\t\t\"_snapshot\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: {},\n\t\t\t},\n\t\t\t\"_syncSnapshot\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: syncSnapshot,\n\t\t\t},\n\n\t\t\t\"_partialMetadata\": {\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t},\n\n\t\t\t\"isDirty\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: isDirty,\n\t\t\t},\n\t\t\t\"revert\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: revert,\n\t\t\t},\n\n\t\t\t\"isPartial\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: isPartial,\n\t\t\t},\n\t\t} );\n\n\t\treturn persistedResource;\n\t},\n\n\n\tis( value:any ):value is Resource {\n\t\treturn TransientResource.is( value )\n\t\t\t&& Resource.isDecorated( value )\n\t\t\t;\n\t},\n\n\tcreate: TransientResource.create,\n\tcreateFrom: TransientResource.createFrom,\n};\n"]}