{"version":3,"sources":["FreeResources.ts"],"names":[],"mappings":"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","file":"FreeResources.js","sourcesContent":["import { ModelDecorator } from \"./core/ModelDecorator\";\nimport { ModelFactory } from \"./core/ModelFactory\";\nimport { Documents } from \"./Documents\";\nimport { IDAlreadyInUseError } from \"./Errors/IDAlreadyInUseError\";\nimport { IllegalArgumentError } from \"./Errors/IllegalArgumentError\";\nimport { JSONLDConverter } from \"./JSONLD/Converter\";\nimport { DigestedObjectSchema } from \"./ObjectSchema\";\nimport {\n\tPointer,\n\tPointerLibrary,\n\tPointerValidator,\n} from \"./Pointer\";\nimport { RDFNode } from \"./RDF/Node\";\nimport { URI } from \"./RDF/URI\";\nimport { TransientResource } from \"./Resource\";\nimport * as Utils from \"./Utils\";\n\n\nexport interface BaseFreeResources {\n\t_documents:Documents;\n}\n\n\nexport interface FreeResources extends PointerLibrary, PointerValidator {\n\t_documents:Documents;\n\t_resourcesIndex:Map<string, TransientResource>;\n\n\thasResource( id:string ):boolean;\n\n\tgetResource( id:string ):TransientResource;\n\n\tgetResources():TransientResource[];\n\n\tgetPointer( id:string ):TransientResource;\n\n\tcreateResource( id?:string ):TransientResource;\n\n\tcreateResourceFrom<T>( object:T, id?:string ):TransientResource & T;\n\n\ttoJSON():object;\n}\n\n\nexport interface FreeResourcesFactory extends ModelFactory<FreeResources>, ModelDecorator<FreeResources> {\n\tis( value:any ):value is FreeResources;\n\n\tisDecorated( object:object ):object is FreeResources;\n\n\n\tcreate<T extends object>( data:T & BaseFreeResources ):T & FreeResources;\n\n\tcreateFrom<T extends object>( object:T & BaseFreeResources ):T & FreeResources;\n\n\tdecorate<T extends object>( object:T, documents:Documents ):T & FreeResources;\n}\n\n\nfunction hasPointer( this:FreeResources, id:string ):boolean {\n\tif( ! inLocalScope( id ) ) {\n\t\treturn this._documents.hasPointer( id );\n\t}\n\n\treturn this.hasResource( id );\n}\n\nfunction getPointer( this:FreeResources, id:string ):Pointer {\n\tif( ! inLocalScope( id ) ) {\n\t\treturn this._documents.getPointer( id );\n\t}\n\n\tlet resource:TransientResource = this.getResource( id );\n\n\treturn ! resource ? this.createResource( id ) : resource;\n}\n\nfunction inLocalScope( id:string ):boolean {\n\treturn URI.isBNodeID( id );\n}\n\nfunction inScope( this:FreeResources, idOrPointer:string | Pointer ):boolean {\n\tlet id:string = Utils.isString( idOrPointer ) ? idOrPointer : idOrPointer.id;\n\n\treturn inLocalScope( id ) || this._documents.inScope( id );\n}\n\nfunction hasResource( this:FreeResources, id:string ):boolean {\n\treturn this._resourcesIndex.has( id );\n}\n\nfunction getResource( this:FreeResources, id:string ):TransientResource {\n\treturn this._resourcesIndex.get( id ) || null;\n}\n\nfunction getResources( this:FreeResources ):TransientResource[] {\n\treturn Utils.ArrayUtils.from( this._resourcesIndex.values() );\n}\n\nfunction createResource( this:FreeResources, id?:string ):TransientResource {\n\treturn this.createResourceFrom( {}, id );\n}\n\nfunction createResourceFrom<T extends object>( this:FreeResources, object:T, id?:string ):TransientResource & T {\n\tif( id ) {\n\t\tif( ! inLocalScope( id ) ) throw new IllegalArgumentError( `The id \"${ id }\" is out of scope.` );\n\t\tif( this._resourcesIndex.has( id ) ) throw new IDAlreadyInUseError( `The id \"${ id }\" is already in use by another resource.` );\n\t} else {\n\t\tid = URI.generateBNodeID();\n\t}\n\n\tlet resource:TransientResource & T = TransientResource.createFrom<T>( object );\n\tresource.id = id;\n\n\tthis._resourcesIndex.set( id, resource );\n\n\treturn resource;\n}\n\nfunction toJSON( this:FreeResources, key?:string ):RDFNode[] {\n\tconst generalSchema:DigestedObjectSchema = this._documents.getGeneralSchema();\n\tconst jsonldConverter:JSONLDConverter = this._documents.jsonldConverter;\n\n\treturn this\n\t\t.getResources()\n\t\t.map( resource => {\n\t\t\tconst resourceSchema:DigestedObjectSchema = this._documents.getSchemaFor( resource );\n\t\t\treturn jsonldConverter.expand( resource, generalSchema, resourceSchema );\n\t\t} )\n\t\t;\n}\n\nexport const FreeResources:FreeResourcesFactory = {\n\tis( value:any ):value is FreeResources {\n\t\treturn FreeResources.isDecorated( value )\n\t\t\t;\n\t},\n\n\tisDecorated( object:object ):object is FreeResources {\n\t\treturn (\n\t\t\tUtils.hasPropertyDefined( object, \"_documents\" ) &&\n\t\t\tUtils.hasPropertyDefined( object, \"_resourcesIndex\" ) &&\n\n\t\t\tUtils.hasFunction( object, \"hasResource\" ) &&\n\t\t\tUtils.hasFunction( object, \"getResource\" ) &&\n\t\t\tUtils.hasFunction( object, \"getResources\" ) &&\n\t\t\tUtils.hasFunction( object, \"createResource\" ) &&\n\t\t\tUtils.hasFunction( object, \"createResourceFrom\" ) &&\n\n\t\t\tUtils.hasFunction( object, \"hasPointer\" ) &&\n\t\t\tUtils.hasFunction( object, \"getPointer\" ) &&\n\n\t\t\tUtils.hasFunction( object, \"inScope\" ) &&\n\n\t\t\tUtils.hasFunction( object, \"toJSON\" )\n\t\t);\n\t},\n\n\n\tcreate<T extends object>( data:T & BaseFreeResources ):T &FreeResources {\n\t\tconst copy:T & BaseFreeResources = Object.assign( {}, data );\n\t\treturn FreeResources.createFrom( copy );\n\t},\n\n\tcreateFrom<T extends object>( object:T & BaseFreeResources ):T & FreeResources {\n\t\treturn FreeResources.decorate<T>( object, object._documents );\n\t},\n\n\tdecorate<T extends object>( object:T, documents:Documents ):T & FreeResources {\n\t\tif( FreeResources.isDecorated( object ) ) return object;\n\n\t\tObject.defineProperties( object, {\n\t\t\t\"_documents\": {\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: documents,\n\t\t\t},\n\t\t\t\"_resourcesIndex\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: new Map<string, TransientResource>(),\n\t\t\t},\n\t\t\t\"hasPointer\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: hasPointer,\n\t\t\t},\n\t\t\t\"getPointer\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getPointer,\n\t\t\t},\n\t\t\t\"inScope\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: inScope,\n\t\t\t},\n\t\t\t\"hasResource\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: hasResource,\n\t\t\t},\n\t\t\t\"getResource\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getResource,\n\t\t\t},\n\t\t\t\"getResources\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: getResources,\n\t\t\t},\n\t\t\t\"createResource\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: createResource,\n\t\t\t},\n\t\t\t\"createResourceFrom\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: createResourceFrom,\n\t\t\t},\n\t\t\t\"toJSON\": {\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: toJSON,\n\t\t\t},\n\t\t} );\n\n\t\treturn <any> object;\n\t},\n};\n\n"]}