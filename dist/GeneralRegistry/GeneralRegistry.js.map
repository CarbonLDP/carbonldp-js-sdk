{"version":3,"sources":["GeneralRegistry/GeneralRegistry.ts"],"names":[],"mappings":"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","file":"GeneralRegistry.js","sourcesContent":["import { Context } from \"../Context/Context\";\n\nimport { IllegalArgumentError } from \"../Errors/IllegalArgumentError\";\n\nimport { ModelDecorator } from \"../Model/ModelDecorator\";\nimport { ModelFactory } from \"../Model/ModelFactory\";\nimport { ModelPrototype } from \"../Model/ModelPrototype\";\n\nimport { ObjectSchemaResolver } from \"../ObjectSchema/ObjectSchemaResolver\";\n\nimport { Pointer } from \"../Pointer/Pointer\";\n\nimport { URI } from \"../RDF/URI\";\nimport { BaseRegistry } from \"../Registry/BaseRegistry\";\n\nimport { RegisteredPointer } from \"../Registry/RegisteredPointer\";\nimport { Registry } from \"../Registry/Registry\";\n\nimport { BaseResolvablePointer } from \"../Repository/BaseResolvablePointer\";\n\nimport { MapUtils } from \"../Utils\";\n\nimport { BaseGeneralRegistry } from \"./BaseGeneralRegistry\";\nimport { TypedModelDecorator } from \"./TypedModelDecorator\";\n\n\nexport interface GeneralRegistry<M extends RegisteredPointer = RegisteredPointer> extends Registry<M>, ObjectSchemaResolver {\n\treadonly context:Context<M>;\n\treadonly registry:GeneralRegistry | undefined;\n\n\n\t__modelDecorators:Map<string, TypedModelDecorator>;\n\n\taddDecorator( decorator:TypedModelDecorator ):this;\n\n\tdecorate( object:{ types?:string[] } ):void;\n\n\n\t_addPointer<T extends object>( pointer:T & Pointer ):T & M;\n\n\t_getLocalID( id:string ):string;\n}\n\n\nexport type OverloadedFns =\n\t| \"context\"\n\t| \"registry\"\n\t| \"_addPointer\"\n\t| \"_getLocalID\"\n\t;\n\nexport type GeneralRegistryFactory =\n\t& ModelPrototype<GeneralRegistry, Registry & ObjectSchemaResolver, OverloadedFns>\n\t& ModelDecorator<GeneralRegistry<any>, BaseGeneralRegistry>\n\t& ModelFactory<GeneralRegistry<any>, BaseGeneralRegistry>\n\t;\n\nexport const GeneralRegistry:GeneralRegistryFactory = {\n\tPROTOTYPE: {\n\t\tget context():Context {\n\t\t\tthrow new IllegalArgumentError( \"Property context is required.\" );\n\t\t},\n\n\t\tget registry( this:GeneralRegistry ):GeneralRegistry<any> | undefined {\n\t\t\tif( ! this.context || ! this.context.parentContext ) return;\n\t\t\treturn this.context.parentContext.registry;\n\t\t},\n\t\tset registry( value:GeneralRegistry<any> ) {},\n\n\n\t\tget __modelDecorators():Map<string, TypedModelDecorator> { return new Map(); },\n\n\n\t\taddDecorator( this:GeneralRegistry, decorator:TypedModelDecorator ):GeneralRegistry {\n\t\t\tif( ! decorator.TYPE ) throw new IllegalArgumentError( \"No TYPE specified in the model decorator.\" );\n\n\t\t\tthis.__modelDecorators.set( decorator.TYPE, decorator );\n\t\t\treturn this;\n\t\t},\n\n\t\tdecorate( this:GeneralRegistry, object:{ types?:string[] } ):void {\n\t\t\tif( ! object.types ) return;\n\n\t\t\tobject.types\n\t\t\t\t.filter( type => this.__modelDecorators.has( type ) )\n\t\t\t\t.map( type => this.__modelDecorators.get( type ) )\n\t\t\t\t.forEach( decorator => decorator.decorate( object ) )\n\t\t\t;\n\t\t},\n\n\n\t\t_addPointer<T extends object>( this:GeneralRegistry, pointer:T & Pointer ):T & RegisteredPointer {\n\t\t\tif( this.context.repository )\n\t\t\t\tObject.assign<T, BaseResolvablePointer>( pointer, { $repository: this.context.repository } );\n\n\t\t\tconst resource:T & RegisteredPointer = Registry.PROTOTYPE._addPointer.call( this, pointer );\n\n\t\t\tresource.$id = this.context.getObjectSchema().resolveURI( resource.$id, { base: true } );\n\n\t\t\treturn resource;\n\t\t},\n\n\t\t_getLocalID( this:GeneralRegistry, id:string ):string {\n\t\t\tconst uri:string = this.context.getObjectSchema().resolveURI( id, { base: true } );\n\n\t\t\tif( ! URI.isAbsolute( uri ) || ! URI.isBaseOf( this.context.baseURI, uri ) )\n\t\t\t\tthrow new IllegalArgumentError( `\"${ uri }\" is out of scope.` );\n\n\t\t\treturn URI.getRelativeURI( uri, this.context.baseURI );\n\t\t},\n\t},\n\n\n\tisDecorated( object:object ):object is GeneralRegistry {\n\t\treturn ModelDecorator\n\t\t\t.hasPropertiesFrom( GeneralRegistry.PROTOTYPE, object )\n\t\t\t;\n\t},\n\n\tdecorate<T extends BaseGeneralRegistry>( object:T ):T & GeneralRegistry {\n\t\tif( GeneralRegistry.isDecorated( object ) ) return object;\n\n\t\tconst target:T & Registry & ObjectSchemaResolver = ModelDecorator\n\t\t\t.decorateMultiple( object, Registry as ModelDecorator<Registry, BaseRegistry>, ObjectSchemaResolver );\n\n\t\tif( ! target.context ) delete target.context;\n\n\t\treturn ModelDecorator\n\t\t\t.definePropertiesFrom( GeneralRegistry.PROTOTYPE, target );\n\t},\n\n\n\tcreate<T extends object>( data:T & BaseGeneralRegistry ):T & GeneralRegistry {\n\t\t// FIXME: TS 3.0\n\t\treturn GeneralRegistry.createFrom( { ...data as any } );\n\t},\n\n\tcreateFrom<T extends object>( object:T & BaseGeneralRegistry ):T & GeneralRegistry {\n\t\tconst registry:T & GeneralRegistry = GeneralRegistry.decorate( object );\n\n\t\tif( registry.registry )\n\t\t\tMapUtils.extend( registry.__modelDecorators, registry.registry.__modelDecorators );\n\n\t\treturn registry;\n\t},\n};\n"]}